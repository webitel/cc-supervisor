{
  "version": 3,
  "sources": ["../../node_modules/@webitel/ui-sdk/src/api/websocket/WebSocketClientController.ts", "../../node_modules/@webitel/ui-sdk/src/api/websocket/config.js", "../../node_modules/@webitel/ui-sdk/src/api/websocket/enums/WebSocketClientEvent.ts", "../../node_modules/@webitel/ui-sdk/src/api/websocket/websocketErrorEventHandler.ts"],
  "sourcesContent": ["import { shallowReactive } from 'vue';\nimport { Client } from 'webitel-sdk';\n\nimport eventBus from '../../scripts/eventBus';\nimport { endpoint, getConfig } from './config';\nimport { WebSocketClientEvent } from './enums/WebSocketClientEvent';\nimport websocketErrorEventHandler from './websocketErrorEventHandler';\n\nclass WebSocketClientController {\n  cli = null;\n  Event = WebSocketClientEvent;\n\n  _config = getConfig();\n  _on = {\n    [WebSocketClientEvent.ERROR]: [websocketErrorEventHandler],\n    [WebSocketClientEvent.AFTER_AUTH]: [],\n  };\n\n  getCliInstance(createCliInstance = this._createCliInstance) {\n    if (!this.cli) this.cli = createCliInstance();\n    return this.cli;\n  }\n\n  async destroyCliInstance() {\n    if (!window.cli) return;\n\n    await window.cli.destroy();\n    this.cli = null;\n    window.cli = null;\n  }\n\n  addEventListener(event, callback) {\n    if (Array.isArray(callback))\n      this._on[event] = this._on[event].concat(callback);\n    else this._on[event].push(callback);\n  }\n\n  _createCliInstance = async () => {\n    const token = localStorage.getItem('access-token');\n    const configCli = getConfig();\n\n    const config = {\n      endpoint,\n      token,\n      registerWebDevice: configCli.registerWebDevice,\n      debug: configCli.debug,\n    };\n\n    // why reactive? https://github.com/vuejs/core/discussions/7811#discussioncomment-5181921\n    // const cli = new Client(config);\n    const cli = shallowReactive(new Client(config));\n\n    this._on[WebSocketClientEvent.AFTER_AUTH].forEach((callback) => callback());\n    this._on[WebSocketClientEvent.ERROR].forEach((callback) =>\n      cli.on('error', callback),\n    );\n    cli.on(`show_message`, (e) =>\n      eventBus.$emit('notification', {\n        type: e.type,\n        text: e.message,\n        timeout: e.timeout,\n      }),\n    );\n\n    await cli.connect();\n\n    await cli.auth();\n\n    window.cli = cli;\n    return cli;\n  };\n}\n\nconst webSocketClientController = new WebSocketClientController();\n\nexport default webSocketClientController;\n", "export const getConfig = () => {\n  let cliConfig = {};\n  try {\n    const CONFIG = JSON.parse(localStorage.getItem('CONFIG'));\n    cliConfig = CONFIG.CLI || {};\n  } catch {}\n  return cliConfig;\n};\n\nconst { hostname, protocol } = window.location;\nconst origin = `${protocol}//${hostname}`.replace(/^http/, 'ws');\nconst fallbackSocketPath =\n  import.meta.env.VITE_WEB_SOCKET_URL || 'wss://test.webitel.me/ws';\n\nexport const endpoint =\n  import.meta.env.MODE === 'production' ? `${origin}/ws` : fallbackSocketPath;\n", "export const WebSocketClientEvent = {\n  AFTER_AUTH: 'afterAuth',\n  ERROR: 'error',\n} as const;\n\nexport type WebSocketClientEvent =\n  (typeof WebSocketClientEvent)[keyof typeof WebSocketClientEvent];\n", "import i18n from '../../locale/i18n.js';\nimport eventBus from '../../scripts/eventBus.js';\n\nconst websocketErrorEventHandler = (error) => {\n  const errLocale = `error.websocket.${error.id?.replaceAll('.', '_')}`;\n  const message = {\n    type: 'error',\n    text: i18n.global.te(errLocale) ? i18n.global.t(errLocale) : error,\n  };\n  eventBus.$emit('notification', message);\n  return error;\n};\n\nexport default websocketErrorEventHandler;\n"],
  "mappings": "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",
  "names": ["import_dist", "import_dist", "import_dist", "import_dist"]
}
